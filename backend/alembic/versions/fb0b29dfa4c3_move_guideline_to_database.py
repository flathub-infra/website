"""Move guideline to database

Revision ID: fb0b29dfa4c3
Revises: 66b535348e74
Create Date: 2023-11-19 16:22:36.163296

"""
import datetime
from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision = "fb0b29dfa4c3"
down_revision = "66b535348e74"
branch_labels = None
depends_on = None


def upgrade():
    # Delete old guideline
    op.execute(
        "DELETE FROM qualitymoderation WHERE guideline_id = 'screenshots-not-maximized'"
    )
    op.execute(
        "DELETE FROM qualitymoderation WHERE guideline_id = 'screenshots-include-window-shadow'"
    )
    op.execute(
        "DELETE FROM qualitymoderation WHERE guideline_id = 'screenshots-multiple-screenshots'"
    )

    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table(
        "apps",
        sa.Column("id", sa.Integer(), nullable=False),
        sa.Column("app_id", sa.String(), nullable=False),
        sa.Column(
            "type",
            sa.Enum(
                "desktop",
                "localization",
                "console-application",
                "generic",
                "runtime",
                "addon",
                name="app_type",
            ),
            nullable=False,
        ),
        sa.Column("installs_last_7_days", sa.Integer(), nullable=False),
        sa.Column("is_fullscreen_app", sa.Boolean(), nullable=False),
        sa.Column(
            "created_at", sa.DateTime(), server_default=sa.text("now()"), nullable=False
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index("apps_unique", "apps", ["app_id"], unique=True)
    op.create_index(op.f("ix_apps_app_id"), "apps", ["app_id"], unique=True)
    op.create_table(
        "guideline_category",
        sa.Column("id", sa.String(), nullable=False),
        sa.Column("order", sa.Integer(), nullable=False),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_table(
        "guideline",
        sa.Column("id", sa.String(), nullable=False),
        sa.Column("url", sa.String(), nullable=False),
        sa.Column("needed_to_pass_since", sa.Date(), nullable=False),
        sa.Column("read_only", sa.Boolean(), nullable=False),
        sa.Column("guideline_category_id", sa.String(), nullable=False),
        sa.Column("show_on_fullscreen_app", sa.Boolean(), nullable=False),
        sa.Column("order", sa.Integer(), nullable=False),
        sa.ForeignKeyConstraint(
            ["guideline_category_id"],
            ["guideline_category.id"],
        ),
        sa.PrimaryKeyConstraint("id"),
    )
    op.create_index(
        op.f("ix_guideline_guideline_category_id"),
        "guideline",
        ["guideline_category_id"],
        unique=False,
    )

    # ### end Alembic commands ###

    op.bulk_insert(
        sa.table(
            "guideline_category",
            sa.Column("id", sa.String(), nullable=False),
            sa.Column("order", sa.Integer(), nullable=False),
        ),
        [
            {"id": "general", "order": 1},
            {"id": "app-icon", "order": 2},
            {"id": "app-name", "order": 3},
            {"id": "app-summary", "order": 4},
            {"id": "screenshots", "order": 5},
        ],
    )

    op.bulk_insert(
        sa.table(
            "guideline",
            sa.Column("id", sa.String(), nullable=False),
            sa.Column("url", sa.String(), nullable=False),
            sa.Column("needed_to_pass_since", sa.Date(), nullable=False),
            sa.Column("read_only", sa.Boolean(), nullable=False),
            sa.Column("guideline_category_id", sa.String(), nullable=False),
            sa.Column("show_on_fullscreen_app", sa.Boolean(), nullable=False),
            sa.Column("order", sa.Integer(), nullable=False),
        ),
        [
            {
                "id": "general-no-trademark-violations",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#no-trademark-violations",
                "needed_to_pass_since": datetime.datetime(2023, 9, 1),
                "read_only": False,
                "guideline_category_id": "general",
                "show_on_fullscreen_app": True,
                "order": 1,
            },
            # This guideline can't be checked, as currently icons are a maximal size of 128x128
            # {
            #     "id": "app-icon-size",
            #     "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#icon-size",
            #     "needed_to_pass_since": datetime.datetime(2023, 9, 1),
            #     "read_only": False,
            # },
            {
                "id": "app-icon-footprint",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#reasonable-footprint",
                "needed_to_pass_since": datetime.datetime(2023, 9, 1),
                "read_only": False,
                "guideline_category_id": "app-icon",
                "show_on_fullscreen_app": True,
                "order": 2,
            },
            {
                "id": "app-icon-contrast",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#good-contrast",
                "needed_to_pass_since": datetime.datetime(2023, 9, 1),
                "read_only": False,
                "guideline_category_id": "app-icon",
                "show_on_fullscreen_app": True,
                "order": 3,
            },
            {
                "id": "app-icon-detail",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#not-too-much-or-too-little-detail",
                "needed_to_pass_since": datetime.datetime(2023, 9, 1),
                "read_only": False,
                "guideline_category_id": "app-icon",
                "show_on_fullscreen_app": True,
                "order": 4,
            },
            {
                "id": "app-icon-no-baked-in-shadows",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#no-baked-in-shadows",
                "needed_to_pass_since": datetime.datetime(2023, 9, 1),
                "read_only": False,
                "guideline_category_id": "app-icon",
                "show_on_fullscreen_app": True,
                "order": 5,
            },
            {
                "id": "app-icon-in-line-with-contemporary-styles",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#in-line-with-contemporary-styles",
                "needed_to_pass_since": datetime.datetime(2023, 9, 1),
                "read_only": False,
                "guideline_category_id": "app-icon",
                "show_on_fullscreen_app": True,
                "order": 6,
            },
            {
                "id": "app-name-not-too-long",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#not-too-long",
                "needed_to_pass_since": datetime.datetime(2023, 9, 1),
                "read_only": True,
                "guideline_category_id": "app-name",
                "show_on_fullscreen_app": True,
                "order": 7,
            },
            {
                "id": "app-name-just-the-name",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#just-the-name",
                "needed_to_pass_since": datetime.datetime(2023, 9, 1),
                "read_only": False,
                "guideline_category_id": "app-name",
                "show_on_fullscreen_app": True,
                "order": 8,
            },
            {
                "id": "app-no-weird-formatting",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#no-weird-formatting",
                "needed_to_pass_since": datetime.datetime(2023, 9, 1),
                "read_only": False,
                "guideline_category_id": "app-name",
                "show_on_fullscreen_app": True,
                "order": 9,
            },
            {
                "id": "app-summary-not-too-long",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#not-too-long-1",
                "needed_to_pass_since": datetime.datetime(2023, 9, 1),
                "read_only": True,
                "guideline_category_id": "app-summary",
                "show_on_fullscreen_app": True,
                "order": 10,
            },
            {
                "id": "app-summary-not-technical",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#not-technical",
                "needed_to_pass_since": datetime.datetime(2023, 9, 1),
                "read_only": False,
                "guideline_category_id": "app-summary",
                "show_on_fullscreen_app": True,
                "order": 11,
            },
            {
                "id": "app-summary-no-weird-formatting",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#no-weird-formatting-1",
                "needed_to_pass_since": datetime.datetime(2023, 9, 1),
                "read_only": False,
                "guideline_category_id": "app-summary",
                "show_on_fullscreen_app": True,
                "order": 12,
            },
            {
                "id": "app-summary-dont-repeat-app-name",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#dont-repeat-the-name",
                "needed_to_pass_since": datetime.datetime(2023, 9, 1),
                "read_only": False,
                "guideline_category_id": "app-summary",
                "show_on_fullscreen_app": True,
                "order": 13,
            },
            {
                "id": "app-summary-dont-start-with-an-article",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#dont-start-with-an-article",
                "needed_to_pass_since": datetime.datetime(2023, 9, 1),
                "read_only": False,
                "guideline_category_id": "app-summary",
                "show_on_fullscreen_app": True,
                "order": 14,
            },
            {
                "id": "screenshots-at-least-one-screenshot",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#at-least-one-screenshot",
                "needed_to_pass_since": datetime.datetime(2023, 9, 30),
                "read_only": True,
                "guideline_category_id": "screenshots",
                "show_on_fullscreen_app": True,
                "order": 15,
            },
            {
                "id": "screenshots-tag-screenshots-with-correct-language",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#tag-screenshots-with-correct-language",
                "needed_to_pass_since": datetime.datetime(2023, 9, 30),
                "read_only": False,
                "guideline_category_id": "screenshots",
                "show_on_fullscreen_app": True,
                "order": 16,
            },
            {
                "id": "screenshots-just-the-app-window",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#just-the-app-window",
                "needed_to_pass_since": datetime.datetime(2023, 9, 30),
                "read_only": False,
                "guideline_category_id": "screenshots",
                "show_on_fullscreen_app": True,
                "order": 17,
            },
            {
                "id": "screenshots-take-screenshots-on-linux",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#take-screenshots-on-linux",
                "needed_to_pass_since": datetime.datetime(2023, 9, 30),
                "read_only": False,
                "guideline_category_id": "screenshots",
                "show_on_fullscreen_app": False,
                "order": 18,
            },
            {
                "id": "screenshots-default-settings",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#default-settings",
                "needed_to_pass_since": datetime.datetime(2023, 9, 30),
                "read_only": False,
                "guideline_category_id": "screenshots",
                "show_on_fullscreen_app": False,
                "order": 19,
            },
            {
                "id": "screenshots-include-window-shadow-and-rounded-corners",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#include-window-shadow-and-rounded-corners",
                "needed_to_pass_since": datetime.datetime(2023, 9, 30),
                "read_only": False,
                "guideline_category_id": "screenshots",
                "show_on_fullscreen_app": False,
                "order": 20,
            },
            {
                "id": "screenshots-reasonable-window-size",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#reasonable-window-size",
                "needed_to_pass_since": datetime.datetime(2023, 9, 30),
                "read_only": False,
                "guideline_category_id": "screenshots",
                "show_on_fullscreen_app": True,
                "order": 21,
            },
            {
                "id": "screenshots-good-content",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#good-content",
                "needed_to_pass_since": datetime.datetime(2023, 9, 30),
                "read_only": False,
                "guideline_category_id": "screenshots",
                "show_on_fullscreen_app": True,
                "order": 22,
            },
            {
                "id": "screenshots-up-to-date",
                "url": "https://docs.flathub.org/docs/for-app-authors/appdata-guidelines/quality-guidelines/#up-to-date",
                "needed_to_pass_since": datetime.datetime(2023, 9, 30),
                "read_only": False,
                "guideline_category_id": "screenshots",
                "show_on_fullscreen_app": True,
                "order": 23,
            },
        ],
    )

    # add foreign key constraint
    op.create_foreign_key(
        None, "qualitymoderation", "guideline", ["guideline_id"], ["id"]
    )


def downgrade():
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(None, "qualitymoderation", type_="foreignkey")
    op.drop_index(op.f("ix_guideline_guideline_category_id"), table_name="guideline")
    op.drop_table("guideline")
    op.drop_table("guideline_category")
    op.drop_index(op.f("ix_apps_app_id"), table_name="apps")
    op.drop_index("apps_unique", table_name="apps")
    op.drop_table("apps")
    # ### end Alembic commands ###
